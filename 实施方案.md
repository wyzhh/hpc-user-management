# HPCç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ”¹é€ å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®èƒŒæ™¯

å°†ç°æœ‰çš„ç®€å•ç”¨æˆ·ç®¡ç†ç³»ç»Ÿæ”¹é€ ä¸ºé€‚åˆç”Ÿäº§HPCç¯å¢ƒçš„ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼š
- æ”¯æŒä»ç”Ÿäº§LDAPæ‰¹é‡å¯¼å…¥ç”¨æˆ·
- ç®¡ç†å‘˜æ‰‹åŠ¨åˆ†é…ç”¨æˆ·è§’è‰²ï¼ˆPI/å­¦ç”Ÿï¼‰
- æ”¯æŒuid/gidå’Œè¯¾é¢˜ç»„ç®¡ç†
- è½¯åˆ é™¤ç­–ç•¥ä¿è¯æ•°æ®ä¸€è‡´æ€§

## ğŸ¯ æ”¹é€ ç›®æ ‡

### 1. **åŠŸèƒ½ç›®æ ‡**
- âœ… é…ç½®é©±åŠ¨çš„ç®¡ç†å‘˜ç®¡ç†
- âœ… LDAPå…¨é‡ç”¨æˆ·å¯¼å…¥
- âœ… çµæ´»çš„è§’è‰²åˆ†é…ç³»ç»Ÿ
- âœ… åŸºäºgidçš„è¯¾é¢˜ç»„ç®¡ç†
- âœ… è½¯åˆ é™¤å’ŒåŒæ­¥ç­–ç•¥
- âœ… æ”¯æŒHPCé›†ç¾¤ç‰¹æœ‰å±æ€§

### 2. **æŠ€æœ¯ç›®æ ‡**
- âœ… ä¿æŒç°æœ‰æ¶æ„ä¸å˜
- âœ… æ•°æ®åº“å¹³æ»‘è¿ç§»
- âœ… å‘åå…¼å®¹æ€§
- âœ… æ€§èƒ½ä¼˜åŒ–

## ğŸ—ï¸ åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“é‡æ„ (1-2å¤©)

#### A. æ•°æ®åº“è¿ç§»
```sql
-- 1. å¤‡ä»½ç°æœ‰æ•°æ®
pg_dump -U user -d hpc_management > backup_before_migration.sql

-- 2. åˆ›å»ºæ–°è¡¨ç»“æ„
-- æ‰§è¡Œ: æ–°æ•°æ®åº“è®¾è®¡.sql

-- 3. æ•°æ®è¿ç§»è„šæœ¬
-- å°†ç°æœ‰piså’Œstudentsæ•°æ®è¿ç§»åˆ°æ–°ç»“æ„
```

#### B. æ•°æ®æ¨¡å‹è°ƒæ•´
- åˆ›å»ºç»Ÿä¸€çš„usersè¡¨ä½œä¸ºåŸºç¡€è¡¨
- PIå’Œstudentè¡¨æ”¹ä¸ºè§’è‰²è¡¨ï¼Œå…³è”usersè¡¨
- æ·»åŠ research_groupsè¡¨ç®¡ç†è¯¾é¢˜ç»„
- å¢åŠ å®Œæ•´çš„å®¡è®¡å’ŒåŒæ­¥æ—¥å¿—

### ç¬¬äºŒé˜¶æ®µï¼šLDAPæœåŠ¡å¢å¼º (1å¤©)

#### A. LDAPæœåŠ¡æ‰©å±•
```typescript
// æ–°å¢è·å–uid/gidçš„æ–¹æ³•
async getAllUsersWithPosix(): Promise<LDAPUser[]> {
  // è·å–æ‰€æœ‰ç”¨æˆ·çš„å®Œæ•´POSIXå±æ€§
  // åŒ…æ‹¬: uid, uidNumber, gidNumber, homeDirectory, loginShell
}

async getUsersByGid(gid: number): Promise<LDAPUser[]> {
  // æ ¹æ®gidè·å–è¯¾é¢˜ç»„æˆå‘˜
}

async getGroupInfo(gid: number): Promise<LDAPGroup> {
  // è·å–è¯¾é¢˜ç»„ä¿¡æ¯
}
```

#### B. é…ç½®ç®¡ç†æœåŠ¡
```typescript
class AdminConfigService {
  static loadAdminsFromConfig(): AdminConfig[]
  static initializeAdmins(): Promise<void>
  static validateAdminPermissions(username: string, action: string): boolean
}
```

### ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·å¯¼å…¥å’Œåˆ†é…ç³»ç»Ÿ (2-3å¤©)

#### A. ç”¨æˆ·å¯¼å…¥åŠŸèƒ½
```typescript
class UserImportService {
  // ä»LDAPå¯¼å…¥æ‰€æœ‰ç”¨æˆ·åˆ°usersè¡¨
  static async importAllUsersFromLDAP(): Promise<ImportResult>
  
  // æ£€æµ‹æ–°å¢ç”¨æˆ·å¹¶å¯¼å…¥
  static async importNewUsers(): Promise<ImportResult>
  
  // æ ‡è®°LDAPä¸­åˆ é™¤çš„ç”¨æˆ·
  static async markDeletedUsers(): Promise<MarkResult>
}
```

#### B. è§’è‰²åˆ†é…åŠŸèƒ½
```typescript
class RoleAssignmentService {
  // å°†ç”¨æˆ·åˆ†é…ä¸ºPI
  static async assignUserAsPI(userId: number, piInfo: PIInfo): Promise<void>
  
  // å°†ç”¨æˆ·åˆ†é…ä¸ºå­¦ç”Ÿ
  static async assignUserAsStudent(userId: number, studentInfo: StudentInfo): Promise<void>
  
  // åˆ†é…å­¦ç”Ÿåˆ°PI
  static async assignStudentToPI(studentId: number, piId: number): Promise<void>
  
  // å–æ¶ˆè§’è‰²åˆ†é…
  static async unassignUserRole(userId: number): Promise<void>
}
```

### ç¬¬å››é˜¶æ®µï¼šå‰ç«¯ç•Œé¢æ”¹é€  (2-3å¤©)

#### A. ç”¨æˆ·å¯¼å…¥ç•Œé¢
- LDAPç”¨æˆ·æµè§ˆå’Œç­›é€‰
- æ‰¹é‡è§’è‰²åˆ†é…åŠŸèƒ½
- å¯¼å…¥è¿›åº¦å’Œç»“æœæ˜¾ç¤º

#### B. è§’è‰²ç®¡ç†ç•Œé¢
- æœªåˆ†é…ç”¨æˆ·åˆ—è¡¨
- è§’è‰²åˆ†é…å‘å¯¼
- è¯¾é¢˜ç»„ç®¡ç†ç•Œé¢
- å­¦ç”Ÿ-PIå…³ç³»ç®¡ç†

#### C. ç®¡ç†ç•Œé¢å¢å¼º
- è½¯åˆ é™¤ç”¨æˆ·æŸ¥çœ‹
- åŒæ­¥çŠ¶æ€ç›‘æ§
- æ‰¹é‡æ“ä½œåŠŸèƒ½

### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•å’Œä¼˜åŒ– (1-2å¤©)

#### A. åŠŸèƒ½æµ‹è¯•
- ç”¨æˆ·å¯¼å…¥æµ‹è¯•
- è§’è‰²åˆ†é…æµ‹è¯•
- åŒæ­¥åŠŸèƒ½æµ‹è¯•
- æƒé™æ§åˆ¶æµ‹è¯•

#### B. æ€§èƒ½ä¼˜åŒ–
- å¤§é‡ç”¨æˆ·å¯¼å…¥ä¼˜åŒ–
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
- å‰ç«¯å“åº”ä¼˜åŒ–

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. **ç”¨æˆ·å¯¼å…¥æµç¨‹**
```
LDAPæœåŠ¡å™¨ 
    â†“ (æ‰«ææ‰€æœ‰ç”¨æˆ·)
ç”¨æˆ·å¯¼å…¥æœåŠ¡
    â†“ (è§£æuid/gid/åŸºæœ¬ä¿¡æ¯)
ç”¨æˆ·åŸºç¡€è¡¨ (users)
    â†“ (ç®¡ç†å‘˜åˆ†é…è§’è‰²)
è§’è‰²è¡¨ (pis/students)
    â†“ (å»ºç«‹å…³ç³»)
è¯¾é¢˜ç»„è¡¨ (research_groups)
```

### 2. **è§’è‰²åˆ†é…å·¥ä½œæµ**
```
1. ç®¡ç†å‘˜æŸ¥çœ‹æœªåˆ†é…ç”¨æˆ·åˆ—è¡¨
2. é€‰æ‹©ç”¨æˆ·å¹¶æŒ‡å®šè§’è‰²ç±»å‹ (PI/å­¦ç”Ÿ)  
3. å¡«å†™è§’è‰²ç›¸å…³ä¿¡æ¯
4. ç³»ç»Ÿåˆ›å»ºè§’è‰²è®°å½•
5. æ›´æ–°ç”¨æˆ·ç±»å‹
6. è®°å½•æ“ä½œæ—¥å¿—
```

### 3. **è¯¾é¢˜ç»„ç®¡ç†é€»è¾‘**
```
åŸºäºgidè‡ªåŠ¨è¯†åˆ«è¯¾é¢˜ç»„
    â†“
ç®¡ç†å‘˜æŒ‡å®šè¯¾é¢˜ç»„PI
    â†“  
å­¦ç”Ÿåˆ†é…åˆ°å¯¹åº”è¯¾é¢˜ç»„
    â†“
è‡ªåŠ¨å»ºç«‹å±‚çº§å…³ç³»
```

## ğŸ“Š æ•°æ®è¿ç§»ç­–ç•¥

### 1. **ç°æœ‰æ•°æ®å¤„ç†**
```sql
-- å°†ç°æœ‰PIç”¨æˆ·è¿ç§»åˆ°æ–°ç»“æ„
INSERT INTO users (ldap_dn, username, full_name, email, user_type, uid_number, gid_number)
SELECT ldap_dn, username, full_name, email, 'pi', 1000+id, 1000 FROM pis;

INSERT INTO pis (user_id, department, is_active)
SELECT u.id, p.department, p.is_active 
FROM users u JOIN (SELECT * FROM pis) p ON u.username = p.username;

-- ç±»ä¼¼å¤„ç†studentsæ•°æ®
```

### 2. **LDAPæ•°æ®åŒæ­¥**
```typescript
// é¦–æ¬¡å…¨é‡å¯¼å…¥
async initialImport() {
  const ldapUsers = await ldapService.getAllUsersWithPosix();
  
  for (const ldapUser of ldapUsers) {
    await UserModel.upsert({
      ldap_dn: ldapUser.dn,
      username: ldapUser.uid,
      uid_number: ldapUser.uidNumber,
      gid_number: ldapUser.gidNumber,
      full_name: ldapUser.cn,
      email: ldapUser.mail,
      home_directory: ldapUser.homeDirectory,
      login_shell: ldapUser.loginShell,
      user_type: 'unassigned',  // åˆå§‹ä¸ºæœªåˆ†é…
      is_active: true
    });
  }
}
```

## âš ï¸ é£é™©è¯„ä¼°å’Œåº”å¯¹

### 1. **æŠ€æœ¯é£é™©**
| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|----------|
| å¤§é‡æ•°æ®å¯¼å…¥æ€§èƒ½ | é«˜ | æ‰¹é‡å¤„ç†ã€è¿›åº¦æ˜¾ç¤ºã€åå°ä»»åŠ¡ |
| æ•°æ®ä¸€è‡´æ€§é—®é¢˜ | é«˜ | äº‹åŠ¡å¤„ç†ã€å®Œæ•´æ€§æ£€æŸ¥ã€å›æ»šæœºåˆ¶ |
| LDAPè¿æ¥ç¨³å®šæ€§ | ä¸­ | é‡è¯•æœºåˆ¶ã€è¿æ¥æ± ã€é”™è¯¯å¤„ç† |
| å‰ç«¯å“åº”é€Ÿåº¦ | ä¸­ | åˆ†é¡µåŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨ã€ç¼“å­˜ |

### 2. **ä¸šåŠ¡é£é™©**
| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|----------|
| è§’è‰²åˆ†é…é”™è¯¯ | é«˜ | å®¡æ ¸æµç¨‹ã€æ“ä½œæ—¥å¿—ã€æ’¤é”€åŠŸèƒ½ |
| ç”¨æˆ·è®¿é—®ä¸­æ–­ | é«˜ | å¹³æ»‘è¿ç§»ã€å‘åå…¼å®¹ã€å¿«é€Ÿå›æ»š |
| æ•°æ®ä¸¢å¤± | æé«˜ | å¤šé‡å¤‡ä»½ã€åˆ†é˜¶æ®µè¿ç§»ã€éªŒè¯æœºåˆ¶ |

### 3. **è¿ç»´é£é™©**
| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|------|------|----------|
| è¿ç§»æ—¶é—´è¿‡é•¿ | ä¸­ | åˆ†é˜¶æ®µå®æ–½ã€ç¦»çº¿å¤„ç†ã€æœ€å°åŒ–åœæœº |
| é…ç½®å¤æ‚åº¦ | ä¸­ | æ–‡æ¡£å®Œå–„ã€é…ç½®éªŒè¯ã€é»˜è®¤é…ç½® |

## ğŸš€ å®æ–½å»ºè®®

### 1. **ä¼˜å…ˆçº§æ’åº**
1. **é«˜ä¼˜å…ˆçº§**ï¼šæ•°æ®åº“é‡æ„ã€ç”¨æˆ·å¯¼å…¥
2. **ä¸­ä¼˜å…ˆçº§**ï¼šè§’è‰²åˆ†é…ã€è¯¾é¢˜ç»„ç®¡ç†  
3. **ä½ä¼˜å…ˆçº§**ï¼šç•Œé¢ç¾åŒ–ã€é«˜çº§åŠŸèƒ½

### 2. **æŠ€æœ¯é€‰æ‹©**
- âœ… ä¿æŒç°æœ‰æŠ€æœ¯æ ˆ (Node.js + React + PostgreSQL)
- âœ… å¢é‡å¼æ”¹é€ ï¼Œé¿å…å¤§çˆ†ç‚¸å¼é‡å†™
- âœ… é‡ç”¨ç°æœ‰ä»£ç å’Œç»„ä»¶
- âœ… ä¿æŒAPIå…¼å®¹æ€§

### 3. **æµ‹è¯•ç­–ç•¥**
- å•å…ƒæµ‹è¯•ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
- é›†æˆæµ‹è¯•ï¼šLDAPé›†æˆã€æ•°æ®åº“æ“ä½œ
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼šå®Œæ•´ç”¨æˆ·æµç¨‹
- å‹åŠ›æµ‹è¯•ï¼šå¤§é‡ç”¨æˆ·å¯¼å…¥æ€§èƒ½

### 4. **éƒ¨ç½²ç­–ç•¥**
- è“ç»¿éƒ¨ç½²ï¼šé›¶åœæœºæ›´æ–°
- æ•°æ®åº“è¿ç§»ï¼šå…ˆè¿ç§»ç»“æ„ï¼Œå†è¿ç§»æ•°æ®
- å›æ»šè®¡åˆ’ï¼šå¿«é€Ÿå›é€€æœºåˆ¶
- ç›‘æ§å‘Šè­¦ï¼šå®æ—¶ç›‘æ§ç³»ç»ŸçŠ¶æ€

## ğŸ“ˆ é¢„æœŸæ”¶ç›Š

### 1. **ä¸šåŠ¡ä»·å€¼**
- ğŸ¯ é€‚é…çœŸå®HPCç¯å¢ƒéœ€æ±‚
- ğŸ¯ æé«˜ç”¨æˆ·ç®¡ç†æ•ˆç‡
- ğŸ¯ å‡å°‘æ‰‹åŠ¨æ“ä½œé”™è¯¯
- ğŸ¯ æä¾›å®Œæ•´çš„æ“ä½œå®¡è®¡

### 2. **æŠ€æœ¯ä»·å€¼**  
- ğŸ”§ ç°ä»£åŒ–çš„æ•°æ®åº“è®¾è®¡
- ğŸ”§ æ›´å¥½çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§
- ğŸ”§ å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—
- ğŸ”§ æ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹

## ğŸ“ æ€»ç»“

è¿™ä¸ªæ”¹é€ æ–¹æ¡ˆå®Œå…¨å¯è¡Œä¸”å…·æœ‰å¾ˆé«˜çš„å®è·µä»·å€¼ã€‚å»ºè®®é‡‡ç”¨åˆ†é˜¶æ®µå®æ–½çš„ç­–ç•¥ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„äº¤ä»˜ç‰©å’ŒéªŒæ”¶æ ‡å‡†ã€‚é€šè¿‡åˆç†çš„é£é™©æ§åˆ¶å’Œæµ‹è¯•ç­–ç•¥ï¼Œå¯ä»¥ç¡®ä¿å¹³æ»‘è¿ç§»åˆ°æ–°ç³»ç»Ÿã€‚

**é¢„è®¡æ€»å¼€å‘æ—¶é—´ï¼š7-10ä¸ªå·¥ä½œæ—¥**
**é¢„è®¡è¿ç§»åœæœºæ—¶é—´ï¼š< 2å°æ—¶**
**é¢„è®¡æ€§èƒ½æå‡ï¼šæ”¯æŒ1000+ç”¨æˆ·è§„æ¨¡**

è¿™å°†ä½¿æ‚¨çš„ç³»ç»Ÿä»ä¸€ä¸ªç®€å•çš„åŸå‹å‘å±•ä¸ºçœŸæ­£é€‚åˆç”Ÿäº§ç¯å¢ƒçš„HPCç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼